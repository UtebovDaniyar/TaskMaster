# Настройка UploadThing

## Обзор изменений

Проект был обновлен для использования новой версии UploadThing с `UPLOADTHING_TOKEN` вместо устаревших `UPLOADTHING_SECRET` и `UPLOADTHING_APP_ID`.

## Что было исправлено

### 1. Обновлена конфигурация
- ✅ Удалены устаревшие переменные `UPLOADTHING_SECRET` и `UPLOADTHING_APP_ID`
- ✅ Используется только `UPLOADTHING_TOKEN` согласно новой документации
- ✅ Обновлен `createRouteHandler` для использования `token` вместо старых параметров

### 2. Реализована загрузка файлов
- ✅ Добавлен `UTApi` для серверной загрузки файлов
- ✅ Реализована загрузка изображений в проектах
- ✅ Реализована загрузка изображений в workspace
- ✅ Добавлено автоматическое удаление старых изображений при обновлении

### 3. Улучшена обработка ошибок
- ✅ Добавлена безопасная проверка ответов от UploadThing API
- ✅ Улучшено логирование ошибок
- ✅ Добавлена обработка случаев неудачной загрузки

## Структура файлов

```
src/
├── lib/
│   ├── uploadthing.ts          # Серверная конфигурация UploadThing
│   └── utils/
│       └── uploadthing.ts      # Клиентские утилиты
├── app/api/uploadthing/
│   └── route.ts                # API роуты для UploadThing
├── features/
│   ├── projects/server/route.ts # Загрузка изображений проектов
│   └── workspaces/server/route.ts # Загрузка изображений workspace
└── types/
    └── uploadthing.ts          # Типы для UploadThing
```

## Переменные окружения

В файле `.env` должна быть только одна переменная:

```bash
# UploadThing (новая версия)
UPLOADTHING_TOKEN='your_token_here'
```

## Как получить UPLOADTHING_TOKEN

1. Зайдите в [UploadThing Dashboard](https://uploadthing.com/dashboard)
2. Выберите ваше приложение
3. Перейдите в раздел "API Keys"
4. Скопируйте "Token" (не "Secret Key")

## Функциональность

### Загрузка изображений
- ✅ Создание проектов с изображениями
- ✅ Редактирование изображений проектов
- ✅ Создание workspace с изображениями
- ✅ Редактирование изображений workspace

### Автоматическое управление файлами
- ✅ Удаление старых изображений при обновлении
- ✅ Удаление изображений при удалении проектов/workspace
- ✅ Обработка ошибок загрузки

## Тестирование

1. Запустите приложение: `npm run dev`
2. Создайте новый workspace с изображением
3. Отредактируйте workspace и замените изображение
4. Создайте новый проект с изображением
5. Отредактируйте проект и замените изображение

Все изображения должны корректно загружаться и отображаться в интерфейсе, а также быть видны в вашем UploadThing Dashboard.

## Устранение неполадок

### Изображения не загружаются
1. Проверьте правильность `UPLOADTHING_TOKEN` в `.env`
2. Убедитесь, что токен активен в UploadThing Dashboard
3. Проверьте консоль браузера и серверные логи на наличие ошибок

### Старые изображения не удаляются
1. Проверьте логи сервера на ошибки удаления
2. Убедитесь, что URL изображений корректны
3. Проверьте права доступа токена в UploadThing Dashboard

### Ошибки типизации
1. Перезапустите TypeScript сервер в IDE
2. Убедитесь, что все пакеты установлены: `npm install`
3. Проверьте версии пакетов UploadThing 